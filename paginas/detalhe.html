<!doctype html>
<html lang="pt-br" class="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ficha do Aluno — SAE</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="../css/base.css" />
  <link rel="stylesheet" href="../css/detalhe.css" />
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

  <div class="layout-wrapper">
    
    <aside class="sidebar">
      <div class="sidebar__conteudo">
        <div class="brand">
          <div class="brand__icone">
            <img src="../img/KBT_logo2.png" alt="Logo KBT" class="logo-icon">  
          </div>
          <div class="brand__texto">
            <h1 class="brand__titulo">SAE</h1>
            <p class="brand__subtitulo">Sistema de aula experimental</p>
          </div>
        </div>

        <nav class="menu">
          <a class="menu__item" href="/paginas/admin.html"><span class="material-symbols-outlined">dashboard</span><span>Painel</span></a>
          <a class="menu__item" href="/paginas/admin-coachs.html"><span class="material-symbols-outlined">groups</span><span>Coaches</span></a>
          <a class="menu__item" href="/paginas/agendamentos.html"><span class="material-symbols-outlined">calendar_today</span><span>Agendamentos</span></a>
          <a class="menu__item" href="/paginas/pos-aula.html"><i data-lucide="repeat-2"></i><span>Pós-aula</span></a>
          <a class="menu__item" href="/paginas/relatorio.html"><i data-lucide="chart-line"></i><span>Relatórios</span></a>
          
          <div class="menu__rodape">
            <button id="btnSair" class="menu__item menu__item--botao" type="button">
              <i data-lucide="log-out"></i><span>Sair</span>
            </button>
            <p id="usuarioAdmin" class="sidebar__usuario">Usuário: —</p> 
          </div>
        </nav>
      </div>
    </aside>

    <main class="main-content">
      
      <header class="topbar-dashboard">
        <div class="breadcrumbs">
           <a href="javascript:history.back()" class="link-voltar">
             <span class="material-symbols-outlined">arrow_back</span> Voltar
           </a>
        </div>
      </header>

      <div class="dashboard-container">
        
        <section class="profile-header-card">
          <div class="profile-info">
             <div>
               <h1 id="detAluno">Carregando...</h1>
               <!-- O ID subtitulo foi adicionado aqui para evitar o erro no JS -->
               <p id="subtitulo" style="margin-top: 4px; font-weight: 600; color: var(--texto-fraco);"></p>
               
               <div class="profile-meta">
                 <span class="material-symbols-outlined">call</span> <span id="detWhatsapp">—</span>
                 <span class="dot-separator">•</span>
                 <span class="material-symbols-outlined">calendar_today</span> <span id="detData">—</span>
               </div>
             </div>
          </div>
        </section>

        <div class="dashboard-grid">
          
          <!-- Coluna Esquerda: Resumo e Forms -->
          <div class="col-left">
            <div class="card card-mini-resumo">
                <div class="data-row-compact">
                  <span class="label-mini">TIPO</span>
                  <strong id="detTipo">—</strong>
                </div>
                <span class="tag-version">HOJE</span>
                <div class="data-row-compact">
                  <span class="label-mini">STATUS</span>
                  <div class="profile-status">
                    <span id="badgeStatus" class="status-pill">Pendente</span>
                  </div>
                </div>
            </div>

            <div class="card card-section card-forms-container">
               <h3><span class="material-symbols-outlined">assignment</span> Questionário (Forms)</h3>
               <!-- Container onde as respostas do Kids/Adulto serão injetadas -->
               <div id="detFormRaw" class="lista-detalhes-vertical">
                  <p class="vazio">Carregando formulário...</p>
               </div>
            </div>
          </div>

          <!-- Coluna Central: Avaliação -->
          <div class="col-center">
             <section class="card card-main-display">
                <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                  <h3><span class="material-symbols-outlined">analytics</span> Avaliação Técnica</h3>
                  
                  <!-- Botão discreto para abrir a legenda -->
                <button id="btnVerLegenda" class="btn-help-mini" type="button" title="Ver legenda das notas">
    <span class="material-symbols-outlined">help</span> 
</button>
                </div>

                <div id="seletorCategoria" style="margin: 20px 0; display: none;">
                  <p class="label-input">Categoria do Aluno:</p>
                  <div class="toggle-buttons">
                    <button type="button" class="btn-toggle" id="btnRelAdulto">Adulto</button>
                    <button type="button" class="btn-toggle" id="btnRelKids">Kids</button>
                  </div>
                </div>

                <div id="containerFeedbackCoach" style="display: none;">
                  <form id="formRelatorioVivencia">
                    <div id="camposRelatorio" class="grid-notas"></div>
                    
                    <div class="insight-area">
                        <p class="label-input">Avaliação do coach:</p>
                        <textarea id="txtTraducaoPratica" placeholder="O sistema sugerirá uma análise com base nas notas..."></textarea>
                    </div>

                    <div id="recomendacaoArea" class="rec-box">
                        <p>RECOMENDAÇÃO SUGERIDA</p>
                        <div id="textoRecomendacaoAuto">Preencha as notas para ver a recomendação...</div>
                    </div>

                    <button type="submit" class="btn btn--primario btn-full">Salvar Relatório</button>
                  </form>
                </div>

                <div id="containerFeedbackAdmin" style="display: none;">
                    <button id="btnExportarPDFVivencia" class="btn btn--secundario btn-full" style="margin-bottom: 20px;">
                        <span class="material-symbols-outlined">picture_as_pdf</span> Exportar PDF
                    </button>
                    <div id="leituraRelatorio" class="feedback-admin-box"></div>
                </div>
             </section>
          </div>

          <!-- Coluna Direita: Ações -->
          <div class="col-right">
            <div class="card card-section highlight-card">
              <h3><span class="material-symbols-outlined">settings</span> Gestão</h3>
              
              <div class="acoes-buttons-stack">
                <a id="btnWhatsapp" class="btn btn--whatsapp" target="_blank" href="#">
                  <span class="material-symbols-outlined">chat</span> Chamar WhatsApp
                </a>
                  <!-- BOTÃO E CAMPO DE ALTERAR DATA -->

                  <div id="containerTrocaData" style="display: none; flex-direction: column; gap: 8px; margin-top: 10px; background: rgba(236, 240, 23, 0.692); padding: 12px; border-radius: 12px;">
    <div style="display: flex; flex-direction: column; gap: 8px;">
        <div>
            <label style="color: white; margin: 0; font-size: 11px;">1. Escolha a Data:</label>
            <input type="date" id="inputNovaData" style="padding: 8px; border-radius: 8px; border: none; font-size: 14px; width: 100%;">
        </div>
        <div>
            <label style="color: white; margin: 0; font-size: 11px;">2. Horários Disponíveis:</label>
            <select id="selectNovoHorario" style="padding: 8px; border-radius: 8px; border: none; font-size: 14px; width: 100%;">
                <option value="">Selecione uma data primeiro...</option>
            </select>
        </div>
    </div>
    <button id="btnSalvarNovaData" class="btn btn--ok" style="padding: 10px; font-size: 13px; width: 100%; margin-top: 5px;">
        Confirmar Agendamento
    </button>
</div>
<button id="btnAbrirTrocaData" class="btn btn--secundario" style="margin-top: 8px; border-color: rgba(255,255,255,0.3); color: white;">
  <span class="material-symbols-outlined">calendar_month</span> Alterar Data
</button>


  <div id="modalidadesAula" class="modalidades-grid">
  <button class="pill kids" data-modalidade="Kids">Kids</button>

  <button class="pill strong" data-modalidade="Strong">Strong</button>
  <button class="pill cardio" data-modalidade="Cardio & Burn">Cardio & Burn</button>
  <button class="pill hyrox" data-modalidade="Hyrox">Hyrox</button>
  <button class="pill skill" data-modalidade="Skill">Skill</button>
</div>






                <div id="containerAdminAcoes" class="admin-stack" style="display: none; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
                    <div class="row-buttons" style="display: flex; gap: 10px; margin-bottom: 15px;">
                      <button id="btnConfirmar" class="btn-confirmar-viva" style="flex: 1;">Confirmar</button>
                      <button id="btnFaltou" class="btn btn--erro" style="flex: 1;">Faltou</button>
                    </div>
                    
                    <label class="check-recepcao-styled" style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px; cursor: pointer;">
                        <input type="checkbox" id="checkRecepcao"> 
                        <span style="font-size: 13px; font-weight: 700;">Levou à recepção?</span>
                    </label>

                    <section id="secaoAdminVenda" class="card-warning" style="display: none; background: #fffbeb; border: 1px solid #fde68a; padding: 10px; border-radius: 12px;">
                        <div class="admin-venda-wrapper" style="display: flex; justify-content: flex-start ; align-items: center; gap:8px;">
                          <input type="checkbox" id="checkMatriculado">
                          <span style="font-size: 13px; font-weight: 800; color: #92400e;">Matriculado?</span>
                          
                        </div>
                    </section>
                </div>
              </div>
            </div>
          </div> 
        </div>
      </div>
    </main>
  </div>

  <!-- Modal de Legenda -->
  <div id="modalLegenda" class="modal-legenda" style="display: none;">
    <div class="modal-legenda__conteudo">
        <div class="modal-legenda__header">
            <h3 id="tituloLegenda">Legenda de Avaliação</h3>
            <button id="fecharLegenda" class="icon-btn" type="button"><span class="material-symbols-outlined">close</span></button>
        </div>
        <div id="corpoLegenda" class="modal-legenda__body">
            <!-- Texto injetado via JS -->
        </div>
    </div>
  </div>

  <script type="module" src="../js/guardas.js"></script>
  <script type="module" src="../js/professor.detalhe.js"></script>
  
  <script>
    // Inicializa icones Lucide
    lucide.createIcons();
    
    // Registro Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('../sw.js');
    }
  </script>

<script src="../js/mobile-ui.js"></script>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();
</script>

</body>
</html>